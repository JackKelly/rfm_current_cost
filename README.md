Please see the comments at the top of main.cpp for details.